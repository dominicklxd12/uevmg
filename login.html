<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión</title>
    <link rel="stylesheet" href="css.css">
</head>
<body>
    <div class="top-info-bar">
        <p> Av. El Retorno 5-130 y Av. Ricardo Sánchez, Ibarra, Ecuador | uevmg@gmail.com</p>
    </div>
    <header>
        <div class="header-top">
            
            <img src="unidad-educativa-logo.png" alt="Logo de la Institución" class="logo">
            <div class="header-text">
                <h1>Unidad Educativa </h1>
                <h1>"Victor Manuel Guzman"</h1>
                <p>50 años de Educación Estudiantil</p>
            </div>
            <div class="auth-links">
                <!-- Los enlaces se gestionarán dinámicamente desde script.js -->
            </div>
            <nav>
                <ul class="menu">
                    <li><a href="index.html">Inicio</a></li>
                    <li class="dropdown">
                        <a href="#">Nosotros</a>
                        <ul class="submenu">
                            <li><a href="#quienes-somos">Quiénes Somos</a></li>
                            <li><a href="autoridades.html">Autoridades</a></li>
                            <li><a href="historia.html">Historia</a></li>
                            <li><a href="sede-ambientes.html">Sede y Ambientes</a></li>
                            <li><a href="#simbolos">Símbolos Institucionales</a></li>
                            <li><a href="#oferta-educativa">Oferta Educativa</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Docentes</a>
                        <ul class="submenu">
                            <li><a href="#cronograma">Cronograma de Actividades</a></li>
                            <li><a href="#ministerio">Sistemas del Ministerio de Educación</a></li>
                            <li><a href="#documentos">Documentos Institucionales</a></li>
                            <li><a href="#recursos">Recursos Didácticos</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Padres de Familia</a>
                        <ul class="submenu">
                            <li><a href="#comite-padres">Comité Central de Padres de Familia</a></li>
                            <li><a href="#horario-padres">Horario de Atención a Padres de Familia</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Estudiantes</a>
                        <ul class="submenu">
                            <li><a href="#consejo-estudiantil">Consejo Estudiantil</a></li>
                            <li><a href="#cuadro-honor">Cuadro de Honor</a></li>
                            <li><a href="#horario-clases">Horario de Clases</a></li>
                            <li><a href="#uniforme-escolar">Uniforme Escolar</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Servicios</a>
                        <ul class="submenu">
                            <li><a href="#aula-virtual">Aula Virtual Institucional</a></li>
                            <li><a href="#dece">DECE</a></li>
                            <li><a href="#docente-especial">Docente Especial</a></li>
                            <li><a href="#inclusion">Apoyo a la Inclusión</a></li>
                            <li><a href="#bar-institucional">Bar Institucional</a></li>
                            <li><a href="#banda-musical">Banda Musical</a></li>
                            <li><a href="#biblioteca-virtual">Biblioteca Virtual</a></li>
                            <li><a href="#escuela-futbol">Escuela de Fútbol</a></li>
                            <li><a href="#bastoneras">Grupo de Bastoneras y Cachiporreros</a></li>
                        </ul>
                    </li>
                    <li><a href="ubicacion.html">Contactos</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <main>
        <div class="auth-container">
            <div class="auth-box">
                <h2>Iniciar Sesión</h2>
                <form>
                    <label for="login-usuario">Correo Electrónico:</label>
                    <input type="text" id="login-usuario" name="login-usuario" required>
                    <label for="login-password">Contraseña:</label>
                    <input type="password" id="login-password" name="login-password" required>
                    <div id="captcha-container">
                        <label for="captcha">Resuelve: <span id="captcha-question"></span></label>
                        <input type="text" id="captcha-answer" required>
                    </div>
                    <button type="submit">Iniciar Sesión</button>
                </form>
            </div>
        </div>
    </main>
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>UNIDAD EDUCATIVA "VICTOR MANUEL GUZMAN"</h3>
                <div class="footer-line"></div>
                <p>Todos los contenidos digitales del portal web, se prohíbe su reproducción total, parcial y traducción a cualquier idioma sin autorización escrita por su titular.</p>
            </div>
            <div class="footer-section">
                <h3>ACCESOS DIRECTOS</h3>
                <div class="footer-line"></div>
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="registro.html">Registro</a></li>
                    <li><a href="#autoridades">Autoridades</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>CONTACTOS</h3>  
                <div class="footer-line"></div>
                <p>Av. El Retorno 5-130 y Av. Ricardo Sánchez, Ibarra, Ecuador</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Unidad Educativa Victor Manuel Guzmán © Copyrights 2025 Diseñado por área de Informática</p>
        </div>
    </footer>
    <script type="module">
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

        // Configuración de Supabase
        const supabaseUrl = "https://zeijayrxciyzymysbyvp.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplaWpheXJ4Y2l5enlteXNieXZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxNjYyMjMsImV4cCI6MjA1OTc0MjIyM30.DxT8_5acA88JxhVV7n2UqmrZ_9d0DPABi6eKSO8cpDE";
        const supabase = createClient(supabaseUrl, supabaseKey);

        document.querySelector('form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const captchaAnswer = document.getElementById('captcha-answer').value.trim();
            const captchaCorrectAnswer = document.getElementById('captcha-container').dataset.correctAnswer;

            if (captchaAnswer !== captchaCorrectAnswer) {
                alert('Respuesta incorrecta. Por favor, resuelve el captcha correctamente.');
                return;
            }

            const email = document.getElementById('login-usuario').value.trim();
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                alert('Por favor, completa todos los campos.');
                return;
            }

            try {
                const { data: usuarios, error } = await supabase
                    .from('usuarios')
                    .select('*')
                    .eq('email', email);

                if (error) {
                    console.error('Error al verificar las credenciales:', error.message);
                    alert('Ocurrió un error al verificar las credenciales.');
                    return;
                }

                if (usuarios && usuarios.length > 0) {
                    const usuario = usuarios[0];
                    if (usuario.password === password) {
                        localStorage.setItem('usuarioActivo', email);
                        alert('Inicio de sesión exitoso.');
                        window.location.href = 'index.html';
                    } else {
                        alert('Correo o contraseña incorrectos.');
                    }
                } else {
                    alert('Correo o contraseña incorrectos.');
                }
            } catch (err) {
                console.error('Error inesperado:', err);
                alert('Ocurrió un error inesperado. Por favor, intenta nuevamente.');
            }
        });

        // Generar un captcha simple
        function generarCaptcha() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            const question = `${num1} + ${num2}`;
            const answer = (num1 + num2).toString();

            document.getElementById('captcha-question').textContent = question;
            document.getElementById('captcha-container').dataset.correctAnswer = answer;
        }

        generarCaptcha();

        // Verificar si el usuario activo es administrador
        const adminEmail = localStorage.getItem('adminEmail') || 'admin@ejemplo.com'; // Valor predeterminado
        const usuarioActivo = localStorage.getItem('usuarioActivo');
        const menu = document.querySelector('.menu');

        if (usuarioActivo === adminEmail) {
            const adminMenuItem = document.createElement('li');
            adminMenuItem.innerHTML = '<a href="verUsuarios.html">Administración</a>';
            menu.appendChild(adminMenuItem);
        }
    </script>
    <script src="script.js" defer></script>
</body>
</html>
